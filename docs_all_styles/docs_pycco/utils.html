<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>utils.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>utils.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Unclassified utils</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">modulefinder</span> <span class="kn">import</span> <span class="n">Module</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">from</span> <span class="nn">pydoc_fork.custom_types</span> <span class="kn">import</span> <span class="n">TypeLike</span>
<span class="kn">from</span> <span class="nn">pydoc_fork.module_utils</span> <span class="kn">import</span> <span class="n">locate</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Given an object or a path to an object, get the object and its name.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">resolve</span><span class="p">(</span><span class="n">thing</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">forceload</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>\</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">the_object</span> <span class="o">=</span> <span class="n">locate</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">forceload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">the_object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">No</span> <span class="n">Python</span> <span class="n">documentation</span> <span class="n">found</span> <span class="k">for</span> <span class="o">%</span><span class="n">r</span><span class="o">.</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                % thing</span>
<span class="s2">            )</span>
<span class="s2">        return the_object, thing</span>

<span class="s2">    name = getattr(thing, &quot;__name__&quot;, None)</span>
<span class="s2">    if isinstance(name, str):</span>
<span class="s2">        return thing, name</span>
<span class="s2">    else:</span>
<span class="s2">        return thing, str(thing) # HACK</span>
<span class="s2">#DIVIDER</span>
<span class="s2">def describe(thing: TypeLike) -&gt; str:</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="n">Produce</span> <span class="n">a</span> <span class="n">short</span> <span class="n">description</span> <span class="n">of</span> <span class="n">the</span> <span class="n">given</span> <span class="n">thing</span><span class="o">.</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    if inspect.ismodule(thing):</span>
<span class="s2">        if thing.__name__ in sys.builtin_module_names:</span>
<span class="s2">            return &quot;built-in module &quot; + thing.__name__</span>
<span class="s2">        if hasattr(thing, &quot;__path__&quot;):</span>
<span class="s2">            return &quot;package &quot; + thing.__name__</span>
<span class="s2">        return &quot;module &quot; + thing.__name__</span>
<span class="s2">    if inspect.isbuiltin(thing):</span>
<span class="s2">        return &quot;built-in function &quot; + thing.__name__</span>
<span class="s2">    if inspect.isgetsetdescriptor(thing):</span>
<span class="s2">        return f&quot;getset descriptor </span><span class="si">{thing.__objclass__.__module__}</span><span class="s2">.</span><span class="si">{thing.__objclass__.__name__}</span><span class="s2">.</span><span class="si">{thing.__name__}</span><span class="s2">&quot;</span>
<span class="s2">    if inspect.ismemberdescriptor(thing):</span>
<span class="s2">        return f&quot;member descriptor </span><span class="si">{thing.__objclass__.__module__}</span><span class="s2">.</span><span class="si">{thing.__objclass__.__name__}</span><span class="s2">.</span><span class="si">{thing.__name__}</span><span class="s2">&quot;</span>
<span class="s2">    if inspect.isclass(thing):</span>
<span class="s2">        return &quot;class &quot; + thing.__name__</span>
<span class="s2">    if inspect.isfunction(thing):</span>
<span class="s2">        return &quot;function &quot; + thing.__name__</span>
<span class="s2">    if inspect.ismethod(thing):</span>
<span class="s2">        return &quot;method &quot; + thing.__name__</span>
<span class="s2">    return type(thing).__name__</span>
<span class="s2">#DIVIDER</span>
<span class="s2">def _findclass(func: TypeLike) -&gt; Optional[Module]:</span>
<span class="s2">#DIVIDER</span>
<span class="s2">    cls = sys.modules.get(func.__module__)</span>
<span class="s2">    if cls is None:</span>
<span class="s2">        return None</span>
<span class="s2">    for name in func.__qualname__.split(&quot;.&quot;)[:-1]:</span>
<span class="s2">        cls = getattr(cls, name)</span>
<span class="s2">    if not inspect.isclass(cls):</span>
<span class="s2">        return None</span>
<span class="s2">    return cls</span>
<span class="s2">#DIVIDER</span>
<span class="s2">def _finddoc(obj: TypeLike) -&gt; Optional[str]:</span>
<span class="s2">#DIVIDER</span>
<span class="s2">    if inspect.ismethod(obj):</span>
<span class="s2">        name = obj.__func__.__name__</span>
<span class="s2">        self = obj.__self__</span>
<span class="s2">        if (</span>
<span class="s2">            inspect.isclass(self)</span>
<span class="s2">            and getattr(getattr(self, name, None), &quot;__func__&quot;) is obj.__func__  # noqa</span>
<span class="s2">        ):</span>
<span class="s2">#DIVIDER</span>
<span class="s2">            cls = self</span>
<span class="s2">        else:</span>
<span class="s2">            cls = self.__class__</span>
<span class="s2">    elif inspect.isfunction(obj):</span>
<span class="s2">        name = obj.__name__</span>
<span class="s2">        cls = _findclass(obj)</span>
<span class="s2">        if cls is None or getattr(cls, name) is not obj:</span>
<span class="s2">            return None</span>
<span class="s2">    elif inspect.isbuiltin(obj):</span>
<span class="s2">        name = obj.__name__</span>
<span class="s2">        self = obj.__self__</span>
<span class="s2">        if inspect.isclass(self) and self.__qualname__ + &quot;.&quot; + name == obj.__qualname__:</span>
<span class="s2">#DIVIDER</span>
<span class="s2">            cls = self</span>
<span class="s2">        else:</span>
<span class="s2">            cls = self.__class__</span>
<span class="s2">#DIVIDER</span>
<span class="s2">    elif isinstance(obj, property):</span>
<span class="s2">        func = obj.fget</span>
<span class="s2">        name = func.__name__</span>
<span class="s2">        cls = _findclass(cast(TypeLike, func))</span>
<span class="s2">        if cls is None or getattr(cls, name) is not obj:</span>
<span class="s2">            return None</span>
<span class="s2">    elif inspect.ismethoddescriptor(obj) or inspect.isdatadescriptor(obj):</span>
<span class="s2">        name = obj.__name__</span>
<span class="s2">        cls = obj.__objclass__</span>
<span class="s2">        if getattr(cls, name) is not obj:</span>
<span class="s2">            return None</span>
<span class="s2">        if inspect.ismemberdescriptor(obj):</span>
<span class="s2">            slots = getattr(cls, &quot;__slots__&quot;, None)</span>
<span class="s2">            if isinstance(slots, dict) and name in slots:</span>
<span class="s2">                return slots[name]</span>
<span class="s2">    else:</span>
<span class="s2">        return None</span>
<span class="s2">    for base in cls.__mro__:</span>
<span class="s2">        try:</span>
<span class="s2">            doc = _getowndoc(getattr(base, name))</span>
<span class="s2">        except AttributeError:</span>
<span class="s2">            continue</span>
<span class="s2">        if doc is not None:</span>
<span class="s2">            return doc</span>
<span class="s2">    return None</span>
<span class="s2">#DIVIDER</span>
<span class="s2">def _getowndoc(obj: TypeLike) -&gt; str:</span>
<span class="s2">#DIVIDER</span>
<span class="s2">    inherited from its class.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;__doc__&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># null safety</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">:</span>
            <span class="n">typedoc</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__doc__</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typedoc</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">typedoc</span> <span class="o">==</span> <span class="n">doc</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># null safety</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># null safety</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_getdoc</span><span class="p">(</span><span class="n">the_object</span><span class="p">:</span> <span class="n">TypeLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the documentation string for an object.</span>

<span class="sd">    All tabs are expanded to spaces.  To clean up docstrings that are</span>
<span class="sd">    indented to line up with blocks of code, any whitespace than can be</span>
<span class="sd">    uniformly removed from the second line onwards is removed.</span>
<span class="sd">#DIVIDER</span>
<span class="sd">    result = _getdoc(the_object) or inspect.getcomments(the_object)</span>
<span class="sd">    return result and re.sub(&quot;^ *\n&quot;, &quot;&quot;, result.rstrip()) or &quot;&quot;</span>
<span class="sd">#DIVIDER</span>
<span class="sd">#     &quot;&quot;&quot;</span><span class="n">Split</span> <span class="n">a</span> <span class="n">doc</span> <span class="n">string</span> <span class="n">into</span> <span class="n">a</span> <span class="n">synopsis</span> <span class="n">line</span> <span class="p">(</span><span class="k">if</span> <span class="nb">any</span><span class="p">)</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">rest</span><span class="o">.</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#DIVIDER</span>

<span class="s2">#DIVIDER</span>
<span class="s2">def classname(the_object: TypeLike, modname: str) -&gt; str:</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="n">Get</span> <span class="n">a</span> <span class="k">class</span> <span class="nc">name</span> <span class="ow">and</span> <span class="n">qualify</span> <span class="n">it</span> <span class="k">with</span> <span class="n">a</span> <span class="n">module</span> <span class="n">name</span> <span class="k">if</span> <span class="n">necessary</span><span class="o">.</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    name = the_object.__name__</span>
<span class="s2">    if the_object.__module__ != modname:</span>
<span class="s2">        name = the_object.__module__ + &quot;.&quot; + name</span>
<span class="s2">    return name</span>
<span class="s2">#DIVIDER</span>
<span class="s2">def isdata(the_object: Any) -&gt; bool:</span>
<span class="s2">#DIVIDER</span>
<span class="s2">    return not (</span>
<span class="s2">        inspect.ismodule(the_object)</span>
<span class="s2">        or inspect.isclass(the_object)</span>
<span class="s2">        or inspect.isroutine(the_object)</span>
<span class="s2">        or inspect.isframe(the_object)</span>
<span class="s2">        or inspect.istraceback(the_object)</span>
<span class="s2">        or inspect.iscode(the_object)</span>
<span class="s2">    )</span>
<span class="s2">#DIVIDER</span>
<span class="s2">def _is_bound_method(the_function: object) -&gt; bool:</span>
<span class="s2">#DIVIDER</span>
<span class="s2">    if inspect.ismethod(the_function):</span>
<span class="s2">        return True</span>
<span class="s2">    if inspect.isbuiltin(the_function):</span>
<span class="s2">        self = getattr(the_function, &quot;__self__&quot;, None)</span>
<span class="s2">        return not (inspect.ismodule(self) or (self is None))</span>
<span class="s2">    return False</span>
<span class="s2">#DIVIDER</span>
<span class="s2">#     &quot;&quot;&quot;</span><span class="nb">all</span> <span class="n">methods</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#DIVIDER</span>

<span class="s2">#DIVIDER</span>
<span class="s2">def _split_list(</span>
<span class="s2">    the_sequence: Sequence[Any], predicate: Callable[[Any], Any]</span>
<span class="s2">) -&gt; Tuple[List[Any], List[Any]]:</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="n">Split</span> <span class="n">sequence</span> <span class="n">s</span> <span class="n">via</span> <span class="n">predicate</span><span class="p">,</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">pair</span> <span class="p">([</span><span class="n">true</span><span class="p">],</span> <span class="p">[</span><span class="n">false</span><span class="p">])</span><span class="o">.</span>

    <span class="n">The</span> <span class="k">return</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">a</span> <span class="mi">2</span><span class="o">-</span><span class="nb">tuple</span> <span class="n">of</span> <span class="n">lists</span><span class="p">,</span>
        <span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">x</span><span class="p">)],</span>
         <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">predicate</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Find a Class</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">{</span>
        <span class="s2">&quot;__author__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__builtins__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__cached__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__credits__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__date__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__doc__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__file__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__spec__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__loader__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__module__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__name__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__package__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__path__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__qualname__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__slots__&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__version__&quot;</span><span class="p">,</span>
    <span class="p">}:</span>
        <span class="k">return</span> <span class="kc">False</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>Find doc string</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;_fields&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">all_things</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">all_things</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>classmethod</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">classify_class_attrs</span><span class="p">(</span><span class="n">the_object</span><span class="p">:</span> <span class="n">TypeLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>classmethod</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">classify_class_attrs</span><span class="p">(</span>
        <span class="n">cast</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">the_object</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isdatadescriptor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;data descriptor&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">fset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;readonly property&quot;</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Should be tested before isdatadescriptor().</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">sort_attributes</span><span class="p">(</span><span class="n">attrs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">the_object</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TypeLike</span><span class="p">,</span> <span class="nb">type</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Get the documentation string for an object if it is not</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">fields</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">the_object</span><span class="p">,</span> <span class="s2">&quot;_fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">field_order</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fields</span><span class="p">)}</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">field_order</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">keyfunc</span><span class="p">(</span><span class="n">attr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <pre><code>doc = _getowndoc(the_object)
if doc is None:
</code></pre>
<p>try:
       doc = _finddoc(the_object)
   except (AttributeError, TypeError):
       return &ldquo;&rdquo;  # null safety
    if not isinstance(doc, str):
   return &ldquo;&rdquo;  # null safety
    return inspect.cleandoc(doc)</p>
<p>def getdoc(the_object: TypeLike) -&gt; str:
Get the doc string or comments for an object.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="p">(</span><span class="n">field_order</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">attrs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">keyfunc</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>def splitdoc(doc: str) -&gt; Tuple[str, str]:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="c1">#     &quot;&quot;&quot;Get the one-line summary out of a module file.&quot;&quot;&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <pre><code>lines = doc.strip().split("\n")
if len(lines) == 1:
    return lines[0], ""
if len(lines) &gt;= 2 and not lines[1].rstrip():
    return lines[0], "\n".join(lines[2:])
return "", "\n".join(lines)
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Check if an object is of a type that probably means it&rsquo;s data.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <pre><code>Returns True if fn is a bound method, regardless of whether
fn was implemented in Python or in C.
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>def all_methods(cl: type) -&gt; Dict[str, Any]:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <pre><code>methods = {}
for key, value in inspect.getmembers(cl, inspect.isroutine):
    methods[key] = 1
for base in cl.__bases__:
    methods.update(all_methods(base))  # all your base are belong to us
for key in methods.keys():
    methods[key] = getattr(cl, key)
return methods
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <pre><code>yes = []
# pylint: disable=invalid-name
no = []
for x in the_sequence:
</code></pre>
<p>if predicate(x):
       yes.append(x)
   else:
       no.append(x)
    return yes, no</p>
<p>def visiblename(
    name: str, all_things: Optional[List[str]] = None, obj: Optional[Any] = None
) -&gt; bool:
Decide whether to show documentation on a variable.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Certain special names are redundant or internal.
XXX Remove <strong>initializing</strong>?</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>Private names are hidden, but special names are displayed.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Namedtuples have public fields and methods with a single leading underscore</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>only document that which the programmer exported in <strong>all</strong></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>Wrap inspect.classify_class_attrs, with fixup for data descriptors.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>Sort the attrs list in-place by _fields and then alphabetically by name</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>This allows data descriptors to be ordered according
to a _fields attribute if present.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>Sorting function</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>

    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>def source_synopsis(file: TextIO) -&gt; str:
    line = file.readline()
    while line[:1] == &ldquo;#&rdquo; or not line.strip():
        line = file.readline()
        if not line:
            break
    line = line.strip()
    if line[:4] == &lsquo;r&rdquo;&ldquo;&rdquo;&rsquo;:
        line = line[1:]
    if line[:3] == &lsquo;&ldquo;&rdquo;&ldquo;&rsquo;:
        line = line[3:]
        if line[-1:] == &ldquo;\&ldquo;:
            line = line[:-1]
        while not line.strip():
            line = file.readline()
            if not line:
                break
        result = line.split(&lsquo;&ldquo;&rdquo;&ldquo;&rsquo;)[0].strip()
    else:
        result = &ldquo;&rdquo;  # null safety
    return result</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>def synopsis(
    filename: str, cache: Dict[str, Any] = {}  # noqa - the mutability is on purpose!!!
) -&gt; Optional[str]:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <pre><code>mtime = os.stat(filename).st_mtime
lastupdate, result = cache.get(filename, (None, None))
if lastupdate is None or lastupdate &lt; mtime:
    # Look for binary suffixes first, falling back to source.
    if filename.endswith(tuple(importlib.machinery.BYTECODE_SUFFIXES)):
        loader_cls = importlib.machinery.SourcelessFileLoader
    elif filename.endswith(tuple(importlib.machinery.EXTENSION_SUFFIXES)):
        loader_cls = importlib.machinery.ExtensionFileLoader
    else:
        loader_cls = None
    # Now handle the choice.
    if loader_cls is None:
        # Must be a source file.
        try:
            file = tokenize.open(filename)
        except OSError:
            # module can't be opened, so skip it
            return None
        # text modules can be directly examined
        with file:
            result = source_synopsis(file)
    else:
        # Must be a binary module, which has to be imported.
        loader = loader_cls("__temp__", filename)
        # XXX We probably don't need to pass in the loader here.
        spec = importlib.util.spec_from_file_location(
            "__temp__", filename, loader=loader
        )
        try:
            module = importlib._bootstrap._load(spec)
        # pylint: disable=broad-except
        except BaseException:
            return None
        del sys.modules["__temp__"]
        result = module.__doc__.splitlines()[0] if module.__doc__ else None
    # Cache the result.
    cache[filename] = (mtime, result)
return cast(str, result)  # hope this is a str?
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
